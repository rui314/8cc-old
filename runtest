#!/bin/sh
echo
./tests

echo 'main() {printf("Hello, world!\n");}' | ./8cc - tmp$$.o
gcc -o tmp$$ tmp$$.o
[ "`./tmp$$`" = 'Hello, world!' ] || (echo NG; exit)

echo 'main() {printf("%2.2f %2.2f %d\n", 12.34, 56.78, 42);}' | ./8cc - tmp$$.o
gcc -o tmp$$ tmp$$.o
[ "`./tmp$$`" = '12.34 56.78 42' ] || (echo NG; exit)

echo 'main() {int i = 3; printf("%d", i);}' | ./8cc - tmp$$.o
gcc -o tmp$$ tmp$$.o
[ "`./tmp$$`" = '3' ] || (echo NG; exit)

echo 'main() {int i = 3; int j = i; printf("%d", j);}' | ./8cc - tmp$$.o
gcc -o tmp$$ tmp$$.o
[ "`./tmp$$`" = '3' ] || (echo NG; exit)

echo 'main() {int i = atoi("50"); int j = i; printf("%d", j);}' | ./8cc - tmp$$.o
gcc -o tmp$$ tmp$$.o
[ "`./tmp$$`" = '50' ] || (echo NG; exit)

rm -f tmp$$ tmp$$.o

echo OK
